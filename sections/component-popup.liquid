{{ 'component-popup.css' | asset_url | stylesheet_tag }}

<div id="sitePopup" class="popup--overlay{% if section.settings.modal_layout == 'horizontal' %} popup-layout-horizontal{% endif %}" role="dialog" aria-modal="true">
  <div class="popup--modal color-scheme-{{ section.settings.bg_color }}">
    <div class="popup--header{% if section.settings.image == blank %} popup--header-no-image{% endif %}">
    <button id="popupCloseButton" class="popup--modal-close-button" aria-label="{{ 'accessibility.close' | t }}">{% render 'icon-close' %}</button>
    </div>
    <div class="popup--modal-content color-scheme-{{ section.settings.text_color }}">
      {% if section.settings.image != blank %}
        <div class="popup--modal-image">
          {{ section.settings.image | image_url: width: 1080 | image_tag: loading: 'lazy' }}
        </div>
      {% endif %}
      <div class="popup--modal-text">
        <h3>{{ section.settings.heading }}</h3>
        {{ section.settings.description }}
        {% if section.settings.btn_enable %}
        <a href="{{ section.settings.btn_link }}" id="popupLinkButton" role="link" class="button button--{{ section.settings.btn_style }}">{{ section.settings.btn_txt }}</a>
        {% endif %}
      </div>
    </div>
  </div>
<div id="popupBackground" class="popup--overlay-background"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  var popup = document.getElementById('sitePopup');
  var closeBtn = document.getElementById('popupCloseButton');
  var popupBg = document.getElementById('popupBackground');
  var popupButton = document.getElementById('popupLinkButton');

  // Function to display popup
  setTimeout(function() {
    // Check if the "popup-hidden" cookie exists
    var popupHidden = getCookie("house-popup-hidden");

    // If "popup-hidden" cookie does not exist, display the popup
    if (!popupHidden) {
      popup.classList.add('active');
    }
  }, 8000); // 8 seconds delay

  if (popupButton) {
    popupButton.addEventListener('click', function () {
      // Hide the popup
      popup.classList.remove('active');
      
      // Set the "popup-hidden" cookie to prevent the popup from showing for the next 2 hours
      var expiryDate = new Date();
      expiryDate.setTime(expiryDate.getTime() + (2 * 60 * 60 * 1000));
      document.cookie = "house-popup-hidden=true; expires=" + expiryDate.toUTCString() + "; path=/;";
    });
  }
  
  popupBg.addEventListener('click', function () {
    // Hide the popup
    popup.classList.remove('active');
    
    // Set the "popup-hidden" cookie to prevent the popup from showing for the next 2 hours
    var expiryDate = new Date();
    expiryDate.setTime(expiryDate.getTime() + (2 * 60 * 60 * 1000));
    document.cookie = "house-popup-hidden=true; expires=" + expiryDate.toUTCString() + "; path=/;";
  });
  
  closeBtn.addEventListener('click', function () {
    // Hide the popup
    popup.classList.remove('active');
    
    // Set the "popup-hidden" cookie to prevent the popup from showing for the next 2 hours
    var expiryDate = new Date();
    expiryDate.setTime(expiryDate.getTime() + (2 * 60 * 60 * 1000));
    document.cookie = "house-popup-hidden=true; expires=" + expiryDate.toUTCString() + "; path=/;";
  });

  // Function to get cookie value by name
  function getCookie(cookieName) {
    var name = cookieName + "=";
    var decodedCookie = decodeURIComponent(document.cookie);
    var cookieArray = decodedCookie.split(';');
    for(var i = 0; i < cookieArray.length; i++) {
      var cookie = cookieArray[i].trim();
      if (cookie.indexOf(name) == 0) {
        return cookie.substring(name.length, cookie.length);
      }
    }
    return "";
  }
  
});

</script>

{% schema %}
  {
    "name": "t:sections.popup.name",
    "enabled_on": {
      "groups": ["header"]
    },
    "settings": [
    {
    "type": "image_picker",
    "id": "image",
    "label": "t:sections.all.image"
    },
    {
	"type": "text",
	"id": "heading",
	"label": "t:sections.all.heading"
	},
    {
	"type": "richtext",
	"id": "description",
	"label": "t:sections.all.sub_heading"
	},   
    {
      "type": "select",
      "id": "content_alignment",
      "label": "t:sections.all.alignment.alignment_header",
      "options": [
        {
          "value": "left",
          "label": "t:sections.all.alignment.left"
        },
        {
          "value": "center",
          "label": "t:sections.all.alignment.center"
        }
		],
      "default": "center"
    },
    {
      "type": "select",
      "id": "modal_layout",
      "label": "t:sections.all.layout",
      "options": [
        {
          "value": "vertical",
          "label": "t:sections.all.layouts.vertical"
        },
        {
          "value": "horizontal",
          "label": "t:sections.all.layouts.horizontal"
        }
		],
      "default": "vertical"
    },
    {
	"type": "checkbox",
	"id": "btn_enable",
	"default": false,
    "label": "t:sections.all.buttons.show_button"
	},
    {
	"type": "text",
	"id": "btn_txt",
	"label": "t:sections.all.buttons.button_label"
	},
    {
	"type": "url",
	"id": "btn_link",
	"label": "t:sections.all.buttons.button_link"
	},
    {
      "type": "select",
      "id": "btn_style",
      "label": "t:sections.all.buttons.button_style",
      "options": [
        {
          "value": "solid",
          "label": "t:sections.all.buttons.button_style_solid"
        },
        {
          "value": "outline",
          "label": "t:sections.all.buttons.button_style_outline"
        },
        {
          "value": "link",
          "label": "t:sections.all.buttons.button_style_link"
        }
		],
      "default": "solid"
    },
    {
      "type": "header",
      "content": "t:sections.all.colors.label"
    },
    {
      "type": "select",
      "id": "text_color",
      "options": [
        {
          "value": "fg-body",
          "label": "t:sections.all.colors.background_body.label"
        },
        {
          "value": "fg-01",
          "label": "t:sections.all.colors.accent_1.label"
        },
        {
          "value": "fg-02",
          "label": "t:sections.all.colors.accent_2.label"
        },
        {
          "value": "fg-03",
          "label": "t:sections.all.colors.accent_3.label"
        },
        {
          "value": "fg-04",
          "label": "t:sections.all.colors.accent_4.label"
        }
      ],
      "default": "fg-body",
      "label": "t:sections.all.colors.text_color.label"
    },
    {
      "type": "select",
      "id": "bg_color",
      "options": [
        {
          "value": "bg-body",
          "label": "t:sections.all.colors.background_body.label"
        },
        {
          "value": "bg-01",
          "label": "t:sections.all.colors.background_1.label"
        },
        {
          "value": "bg-02",
          "label": "t:sections.all.colors.background_2.label"
        },
        {
          "value": "bg-03",
          "label": "t:sections.all.colors.background_3.label"
        },
        {
          "value": "bg-04",
          "label": "t:sections.all.colors.background_4.label"
        }
      ],
      "default": "bg-body",
      "label": "t:sections.all.colors.background_color.label"
    }
    ],
    "presets": [
      {
        "name": "t:sections.popup.presets.name"
      }
    ]
}
{% endschema %}