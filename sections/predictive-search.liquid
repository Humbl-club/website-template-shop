{% assign product_card_ratio = settings.card_img_aspect_ratio %}
{% assign blog_card_ratio = settings.blog_card_image_ratio %}

{% assign show_products_heading = false %}

{% if predictive_search.resources.articles.size > 0 and settings.predictive_search_show_articles %}
 {% assign show_products_heading = true %} 
{% endif %}

{% if predictive_search.resources.collections.size > 0 and settings.predictive_search_show_collections %}
 {% assign show_products_heading = true %} 
{% endif %}

{% if predictive_search.resources.pages.size > 0 and settings.predictive_search_show_pages %}
 {% assign show_products_heading = true %} 
{% endif %}

{%- if predictive_search.performed -%}
<div id="predictive-search-results" class="predictive-search-results">

{%- if predictive_search.resources.products.size == 0 and predictive_search.resources.collections.size == 0 and predictive_search.resources.articles.size == 0 and predictive_search.resources.pages.size == 0 -%}
<div class="predictive-search-no-results-message">{{ 'templates.search.no_results' | t: terms: predictive_search.terms }}</div>
{%- endif -%}
    
{%- if predictive_search.resources.products.size > 0 -%}
  {% if show_products_heading %}
  <div class="predictive-search-category-heading">
    <h3 id="predictive-search-products">{{ 'templates.search.products' | t }}</h3>
  </div>
  {% endif %}
  <ul role="listbox" class="predictive-search-list" aria-labelledby="predictive-search-products">
    {%- for product in predictive_search.resources.products limit: 6 -%}
      <li role="option" class="predictive-search-product-card">
        <a href="{{ product.url }}">
          {%- if product.featured_media != blank -%}
          <div class="predictive-search-card-image ps-card-ratio-{{ product_card_ratio }}">
          <div class="card-product--badges pc-badges-{{ settings.card_badge_position }}{% if settings.badge_corner_radius > 16 %} pc-badges-rounded-radius{% endif %}">  
          {% for tag in product.tags %}  
            {% if tag contains 'Badge:' %}<span>{{ tag | remove: 'Badge: '}}</span>
          {% endif %}
          {% endfor %}
          {% if settings.badges_show_sale %}
            {% if product.compare_at_price %}<span>{{ 'products.product.on_sale' | t }}</span>{% endif %}  
          {% endif %}
          </div>
            {{ product.featured_media | image_url: width: 600 | image_tag }}
          </div>
          {%- endif -%}
          {%- if settings.predictive_search_show_vendor -%}
          <span class="predictive-search-card-vendor">{{ product.vendor }}</span>
          {%- endif -%}
          <span>{{ product.title }}</span>
          {%- if settings.predictive_search_show_price -%}
          <span>{% render 'price', product: product %}</span>
          {%- endif -%}
        </a>
      </li>
    {%- endfor -%}
  </ul>
{%- endif -%}

{%- if predictive_search.resources.articles.size > 0 and settings.predictive_search_show_articles -%}
  <div class="predictive-search-category-heading">
  <h3 id="predictive-search-articles">
    {{ 'templates.search.articles' | t }}
  </h3>
  </div>
  <ul role="listbox" class="predictive-search-list" aria-labelledby="predictive-search-articles">
    {%- for article in predictive_search.resources.articles limit: 6 -%}
      <li role="option" class="predictive-search-article-card">
        <a href="{{ article.url }}">
          {% if article.image %}<div class="predictive-search-card-image ps-card-ratio-{{ blog_card_ratio }}">{{ article.image | image_url: width: 720 | image_tag }}</div>{% endif %}
          <span>{{ article.title }}</span>
        </a>
      </li>
    {%- endfor -%}
  </ul>
{%- endif -%}

{%- if predictive_search.resources.collections.size > 0 and settings.predictive_search_show_collections -%}
  <div class="predictive-search-category-heading">
  <h3 id="predictive-search-collections">
    {{ 'templates.search.collections' | t }}
  </h3>
  </div>
  <ul role="listbox" class="predictive-search-list" aria-labelledby="predictive-search-collections">
    {%- for collection in predictive_search.resources.collections -%}
      <li role="option" class="predictive-search-page-list">
        <a href="{{ collection.url }}">
          <span>{{ collection.title }}</span>
        </a>
      </li>
    {%- endfor -%}
  </ul>
{%- endif -%}

{%- if predictive_search.resources.pages.size > 0 and settings.predictive_search_show_pages -%}
  <div class="predictive-search-category-heading">
  <h3 id="predictive-search-pages">
    {{ 'templates.search.pages' | t }}
  </h3>
  </div>
  <ul role="listbox" class="predictive-search-list" aria-labelledby="predictive-search-pages">
    {%- for page in predictive_search.resources.pages -%}
      <li role="option" class="predictive-search-page-list">
        <a href="{{ page.url }}">
          <span>{{ page.title }}</span>
        </a>
      </li>
    {%- endfor -%}
  </ul>
{%- endif -%}
  
{%- unless predictive_search.resources.products.size == 0 and predictive_search.resources.articles.size == 0 -%}
<div class="predictive-search-footer">
  <button class="button">{{ 'templates.search.search_for' | t: terms: predictive_search.terms }}</button>
</div>
{%- endunless -%}
  
</div>
{%- endif -%}