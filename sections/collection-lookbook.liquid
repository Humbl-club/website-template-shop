{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-image-with-text.css' | asset_url | stylesheet_tag }}
{{ 'component-slider.css' | asset_url | stylesheet_tag }}
{{ 'section-collection-lookbook.css' | asset_url | stylesheet_tag }}

{%- style -%}
.section-{{ section.id }} .section-inner {
  padding-top: {{ section.settings.padding_top_mobile }}px;
  padding-bottom: {{ section.settings.padding_bottom_mobile }}px;
}

{% if section.settings.content_width == 'page-width-full-grid' and section.settings.section_heading_position != 'top' %}
@media only screen and (min-width: 950px) {
  .section-{{ section.id }} .section-inner {
    padding-top: 0px;
    padding-bottom: 0px;
  }  
  .section-{{ section.id }} .image-with-text--content.iwtt-grid, .section-{{ section.id }} .image-with-text--content.iwtt-slider {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;    
  }
  .section-{{ section.id }} .image-with-text-content-container-flex-start.page-width-full-grid .image-with-text--content.iwtt-grid {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;    
  }
}  
{% else %}
@media only screen and (min-width: 950px) {
  .section-{{ section.id }} .section-inner {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
  }  
}
{% endif %}
  
{% if section.settings.image_alignment == 'right' %}
.section-{{ section.id }} .image-with-text--image {
  order: 2;
}  
{% endif %}

{% if section.settings.txt_alignment == 'right' %}
.section-{{ section.id }} .image-with-text--text {
  text-align: right;
} 
{% endif %}

{% if section.settings.image_corner_style == 'round' %}
  .section-{{ section.id }} .image-with-text--image img {
    border-radius: var(--media-radius);
  }
{% endif %}
 
{%- endstyle -%}

{% if section.settings.card_spacing == 0 %}
{% assign card_space = 'grid-card-spacing-zero' %}
{% endif %}
{% if section.settings.card_spacing == 10 %}
{% assign card_space = 'grid-card-spacing-ten' %}
{% endif %}
{% if section.settings.card_spacing == 20 %}
{% assign card_space = 'grid-card-spacing-twenty' %}
{% endif %}
{% if section.settings.card_spacing == 30 %}
{% assign card_space = 'grid-card-spacing-thirty' %}
{% endif %}
{% if section.settings.card_spacing == 40 %}
{% assign card_space = 'grid-card-spacing-fourty' %}
{% endif %}
{% if section.settings.card_spacing == 50 %}
{% assign card_space = 'grid-card-spacing-fifty' %}
{% endif %}
{% if section.settings.card_spacing == 60 %}
{% assign card_space = 'grid-card-spacing-sixty' %}
{% endif %}

{% assign prod_limit = section.settings.no_items %}
{% assign card_media_aspect_ratio = settings.card_img_aspect_ratio %}
{% assign image_resolution = 'standard' %}

{% assign pagination_style = settings.media_pagination_style %} 

<div class="section-container section-collection-lookbook section-{{ section.id }} collection-lookbook-layout-setting-{{ section.settings.products_layout }}-{{ section.settings.image_alignment }} color-scheme-{{ section.settings.text_color }} color-scheme-{{ section.settings.bg_color }}">

{% if section.settings.top_border %}
<hr class="section-border section-border-color-{{ section.settings.border_color }} section-border-width-{{ section.settings.border_width }}">
{% endif %}
  
<div class="section-inner">

{% if section.settings.section_heading_position == 'top' %}
{% unless section.settings.section_label == blank and section.settings.heading == blank and section.settings.sub_heading == blank %}
<div class="section-header section-header-std-padding page-width text-align-{{ section.settings.txt_alignment }}">  
{% unless section.settings.section_label == blank %}<div class="section-label">{{ section.settings.section_label }}</div>{% endunless %}
{% unless section.settings.heading == blank %}<h2 class="{{ section.settings.heading_size }}">{{ section.settings.heading }}</h2>{% endunless %}
{% unless section.settings.sub_heading == blank %}
<p class="clb-subhead">{{ section.settings.sub_heading }}</p>
{% endunless %}
</div>
{% endunless %}
{% endif %}
  
<div class="image-with-text-content-container{% if section.settings.products_layout == 'grid' %} image-with-text-content-container-flex-start{% else %} image-with-text-carousel{% endif %}{% if section.settings.card_spacing > 0 or section.settings.inner_padding > 0 %} std-page-padding{% endif %} {{ section.settings.content_width | escape }} {{ card_space }}">

<div class="image-with-text--image">
{% if section.settings.section_heading_position == 'overlay_image' %}
<div class="clb-heading-overlay text-align-{{ section.settings.txt_alignment }}">
{% unless section.settings.section_label == blank %}<div class="section-label">{{ section.settings.section_label }}</div>{% endunless %}  
  {% unless section.settings.heading == blank %}<h2 class="{{ section.settings.heading_size }}">{{ section.settings.heading }}</h2>{% endunless %} 
  {% unless section.settings.sub_heading == blank %}<p class="clb-subhead">{{ section.settings.sub_heading }}</p>{% endunless %} 
</div>
{% endif %}
<div class="image-cover-container">

<div class="image-cover-wrapper autoplaying-video">
{% if section.settings.video_url != blank %}
{% assign video_id = 'vid-' | append: section.id %}
  {{
    section.settings.video_url
    | video_tag:
      id: video_id,
      image_size: '1800x',
      autoplay: true,
      loop: true,
      controls: false,
      muted: true
  }} 
{% endif %}

{% if section.settings.video_url == blank %}
{% if section.settings.image %}
{{ section.settings.image | image_url: width: 2400 | image_tag: loading: 'lazy' }}
{% else %}
{% render 'media-placeholder-lifestyle', style: 1 %}
{% endif %}
{% endif %}
</div>

</div> 

</div>

<div class="image-with-text--text align-{{ section.settings.products_alignment }} grid-align-{{ section.settings.grid_horizontal_position }}">
<div class="image-with-text--content iwtt-{{ section.settings.products_layout }}">
{% unless section.settings.section_heading_position == 'top' or section.settings.section_heading_position == 'overlay_image' %}
{% unless section.settings.section_label == blank and section.settings.heading == blank and section.settings.sub_heading == blank %}
<div class="clb-heading-position-middle text-align-{{ section.settings.txt_alignment }}{% if section.settings.products_layout == 'grid' %} clb-heading-position-middle-grid{% endif %}">
{% unless section.settings.section_label == blank %}<div class="section-label">{{ section.settings.section_label }}</div>{% endunless %}
{% unless section.settings.heading == blank %}<h2 class="{{ section.settings.heading_size }} section-heading-middle">{{ section.settings.heading }}</h2>{% endunless %}
{% unless section.settings.sub_heading == blank %}<div class="section-sub-heading-middle"><p class="clb-subhead">{{ section.settings.sub_heading }}</p></div>{% endunless %}
</div>
{% endunless %}
{% endunless %}
  
<div class="slider-outer-wrapper slider-arrows-position-middle"  id="slider-{{ section.id }}">
  
<ul role="list" class="clb-grid slider-element collection-lookbook-products-{{ section.settings.products_layout }} card-size-{{ section.settings.product_card_size }} columns-{{ section.settings.grid_columns }}">
  {% if section.settings.collection != blank %}
  {% for product in section.settings.collection.products limit: prod_limit %}
  <li class="grid-item">
      {% render 'card-product',
        card_product: product,
        media_aspect_ratio: card_media_aspect_ratio,
        show_secondary_image: section.settings.show_secondary_image,
        show_price: section.settings.show_prices,
        price_position: 'bottom',
        show_sale_badges: settings.badges_show_sale,
        show_vendor: section.settings.show_vendor,
        show_vendor_inline: settings.card_show_vendor_inline,
        show_quick_add: false,
        lazy_load: true,
        image_resolution: image_resolution,
        section_id: section.id
      %}    
  </li>  
  {% endfor %}
  {% else %}
  {% for product in (1..prod_limit) %}
  <li class="grid-item">
      {% render 'card-product',
        card_product: product,
        media_aspect_ratio: card_media_aspect_ratio,
        show_secondary_image: false,
        show_price: section.settings.show_prices,
        price_position: 'bottom',
        show_sale_badges: settings.badges_show_sale,
        show_vendor: section.settings.show_vendor,
        show_vendor_inline: settings.card_show_vendor_inline,
        show_quick_add: false,
        lazy_load: false,
        image_resolution: image_resolution,
        section_id: section.id,
        placeholder: true,
        sequence_number: forloop.index
      %}    
  </li>
  {% endfor %}
  {% endif %}
</ul>

{% if section.settings.products_layout == 'slider' %}
{% unless prod_limit == 1 %}  
<div class="slider-arrows arrow-style-{{ section.settings.arrow_style }}">
  <button class="slider-arrow-left" aria-label="{{ 'accessibility.left' | t }}">{% render 'icon-caret' %}</button>
  <button class="slider-arrow-right" aria-label="{{ 'accessibility.right' | t }}">{% render 'icon-caret' %}</button>
</div>
{% endunless %}
{% endif %}
  
{% if section.settings.products_layout == 'slider' and section.settings.collection != blank %}
{% unless prod_limit == 1 %}
<div class="collection-lookbook-slider-pagination clb-pagination-style-{{ pagination_style }}">
  {% for product in section.settings.collection.products limit: prod_limit %}
  <div class="collection-lookbook-slider-pagination-bullet{% if forloop.first %} active{% endif %}" aria-label="{{ forloop.index }}">{{ forloop.index }}</div>
  {% endfor %}
</div>
{% endunless %}
{% endif %}  

{% if section.settings.collection == blank and section.settings.products_layout == 'slider' %}
{% unless prod_limit == 1 %}
<div class="collection-lookbook-slider-pagination clb-pagination-style-{{ pagination_style }}">
  {% for product in (1..prod_limit) %}
  <div class="collection-lookbook-slider-pagination-bullet{% if forloop.first %} active{% endif %}" aria-label="{{ forloop.index }}">{{ forloop.index }}</div>
  {% endfor %}
</div>
{% endunless %}
{% endif %}
  
</div>
  
{% if section.settings.btn_position == 'middle' and section.settings.btn_link != blank %}
<div class="section-viewall-button button-color-scheme--{{ section.settings.button_color_scheme }}">
<a class="button button--{{ section.settings.btn_style }}" href="{{ section.settings.btn_link }}">{{ section.settings.btn_txt }}</a>  
</div>
{% endif %}
</div> 

</div>
</div>  

{% if section.settings.btn_position == 'footer' and section.settings.btn_link != blank %}
<div class="page-width section-viewall-button text-align-{{ section.settings.txt_alignment }} button-color-scheme--{{ section.settings.button_color_scheme }}">
<a class="button button--{{ section.settings.btn_style }}" href="{{ section.settings.btn_link }}">{{ section.settings.btn_txt }}</a>  
</div>
{% endif %}  
  
</div>

{% if section.settings.bottom_border %}
<hr class="section-border section-border-color-{{ section.settings.border_color }} section-border-width-{{ section.settings.border_width }}">
{% endif %}
  
</div>  

{% if section.settings.products_layout == 'slider' %}
<script>
function handleScroll() {
  const slidesContainer = document.querySelector(`#slider-{{ section.id }} .clb-grid`);
  const slideWidth = slidesContainer.offsetWidth;
  const scrollPosition = slidesContainer.scrollLeft;
  const paginationDots = document.querySelectorAll(`#slider-{{ section.id }} .collection-lookbook-slider-pagination-bullet`);

  if (slidesContainer) {
    // Calculate the index based on the scroll position
    const index = Math.floor(scrollPosition / slideWidth);

    // Remove 'active' class from all pagination dots
    paginationDots.forEach(dot => {
      dot.classList.remove('active');
    });

    // Add 'active' class to the pagination dot corresponding to the current scroll position
    paginationDots[index].classList.add('active');
  }
}

// Add event listener to handle scroll events
document.querySelector(`#slider-{{ section.id }} .clb-grid`).addEventListener('scroll', handleScroll);
</script>
{% endif %}
  
{% schema %}
  {
    "name": "t:sections.collection-lookbook.name",
  	"tag": "section",
  	"class": "section",
    "disabled_on": {
      "groups": ["header", "footer"],
      "templates": ["password", "cart"]
    },
    "settings": [
    {
      "type": "header",
      "content": "t:sections.collection-lookbook.settings.header_collection.content"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "t:sections.collection-lookbook.settings.collection.label"
	},
    {
      "type": "video",
      "id": "video_url",
      "label": "t:sections.collection-lookbook.settings.video.label",
      "info": "t:sections.collection-lookbook.settings.video.info"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "t:sections.collection-lookbook.settings.main_image.label"
    },
    {
      "type": "select",
      "id": "image_alignment",
      "label": "t:sections.collection-lookbook.settings.desktop_image_position.label",
      "info": "t:sections.collection-lookbook.settings.desktop_image_position.info",
      "options": [
        {
          "value": "left",
          "label": "t:sections.all.alignment.left"
        },
        {
          "value": "right",
          "label": "t:sections.all.alignment.right"
        }        
		],
      "default": "left"
    },
    {
      "type": "header",
      "content": "t:sections.collection-lookbook.settings.header_products.content"
    },
    {
      "type": "select",
      "id": "products_layout",
      "label": "t:sections.collection-lookbook.settings.products_layout.label",
      "options": [
        {
          "value": "slider",
          "label": "t:sections.collection-lookbook.settings.products_layout.options__1.label"
        },
        {
          "value": "grid",
          "label": "t:sections.collection-lookbook.settings.products_layout.options__2.label"
        }
		],
      "default": "slider"
    },
    {
      "type": "select",
      "id": "arrow_style",
      "label": "t:sections.all.buttons.arrow_style",
      "options": [
        {
          "value": "solid",
          "label": "t:sections.all.buttons.button_style_solid"
        },
        {
          "value": "solid-inverted",
          "label": "t:sections.all.buttons.button_style_solid_inverted"
        },
        {
          "value": "outline",
          "label": "t:sections.all.buttons.button_style_outline"
        },
        {
          "value": "none",
          "label": "t:sections.all.minimal"
        }        
		],
      "default": "solid"
    },
    {
      "type": "select",
      "id": "grid_columns",
      "label": "t:sections.collection-lookbook.settings.product_grid_columns.label",
      "info": "t:sections.collection-lookbook.settings.product_grid_columns.info",
      "options": [
        {
          "value": "single",
          "label": "t:sections.collection-lookbook.settings.product_grid_columns.options__1.label"
        },
        {
          "value": "double",
          "label": "t:sections.collection-lookbook.settings.product_grid_columns.options__2.label"
        }
		],
      "default": "single"
    },
    {
      "type": "select",
      "id": "grid_horizontal_position",
      "label": "t:sections.all.alignment.horizontal_alignment",
      "info": "t:sections.collection-lookbook.settings.product_grid_columns.info",
      "options": [
        {
          "value": "left",
          "label": "t:sections.all.alignment.left"
        },
        {
          "value": "center",
          "label": "t:sections.all.alignment.center"
        }
		],
      "default": "center"
    },
    {
      "type": "select",
      "id": "product_card_size",
      "label": "t:sections.collection-lookbook.settings.product_card_size.label",
      "options": [
        {
          "value": "normal",
          "label": "t:sections.all.normal"
        },
        {
          "value": "small",
          "label": "t:sections.all.size.small"
        }
		],
      "default": "normal"
    },
    {
      "type": "select",
      "id": "products_alignment",
      "label": "t:sections.all.alignment.text_alignment_heading",
      "options": [
        {
          "value": "left",
          "label": "t:sections.all.alignment.left"
        },
        {
          "value": "center",
          "label": "t:sections.all.alignment.center"
        }
		],
      "default": "center"
    },
    {
      "type": "range",
      "id": "no_items",
      "min": 1,
      "max": 12,
      "step": 1,
      "default": 4,
      "label": "t:sections.collection-lookbook.settings.number_of_products.label"
    },
    {
      "type": "checkbox",
      "default": false,
      "id": "show_secondary_image",
      "label": "t:sections.collection-lookbook.settings.show_secondary_image.label"
	},
    {
      "type": "checkbox",
      "default": true,
      "id": "show_prices",
      "label": "t:sections.collection-lookbook.settings.show_price.label"
	},      
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": false,
      "label": "t:sections.collection-lookbook.settings.show_vendor.label"
    },
    {
      "type": "header",
      "content": "t:sections.collection-lookbook.settings.header_heading.content"
    },
    {
      "type": "text",
      "id": "section_label",
      "label": "t:sections.all.caption"
	},
    {
      "type": "text",
      "id": "heading",
      "label": "t:sections.all.heading"
	},
    {
      "type": "text",
      "id": "sub_heading",
      "label": "t:sections.all.sub_heading"
	},
    {
      "type": "select",
      "id": "heading_size",
      "label": "t:sections.all.heading_size.label",
      "options": [
        {
          "value": "h2",
          "label": "t:sections.all.heading_size.normal.label"
        },
        {
          "value": "h1",
          "label": "t:sections.all.heading_size.large.label"
        },
        {
          "value": "h0",
          "label": "t:sections.all.heading_size.xl.label"
        }
		],
      "default": "h2"
    },
    {
      "type": "select",
      "id": "section_heading_position",
      "label": "t:sections.collection-lookbook.settings.heading_position.label",
      "options": [
        {
          "value": "normal",
          "label": "t:sections.all.alignment.inline"
        },
        {
          "value": "top",
          "label": "t:sections.all.alignment.top"
        },
        {
          "value": "overlay_image",
          "label": "t:sections.collection-lookbook.settings.overlay_image.label"
        }
      ],
      "default": "normal"
    },
    {
      "type": "text_alignment",
      "id": "txt_alignment",
      "label": "t:sections.all.alignment.text_alignment_heading",
      "default": "left"
    },
    {
      "type": "header",
      "content": "t:sections.collection-lookbook.settings.header_footer.content"
    },
    {
      "type": "text",
      "id": "btn_txt",
      "label": "t:sections.all.buttons.button_label"
	},
    {
      "type": "url",
      "id": "btn_link",
      "label": "t:sections.all.buttons.button_link"
	},
    {
      "type": "select",
      "id": "button_color_scheme",
      "label": "t:sections.all.buttons.button_color_scheme",
      "options": [
        {
          "value": "default",
          "label": "t:sections.all.default"
        },
        {
          "value": "match-section",
          "label": "t:sections.all.buttons.button_color_scheme_match"
        }
		],
      "default": "default"
    },
    {
      "type": "select",
      "id": "btn_position",
      "label": "t:sections.all.buttons.button_position",
      "options": [
        {
          "value": "middle",
          "label": "t:sections.all.alignment.middle"
        },
        {
          "value": "footer",
          "label": "t:sections.all.alignment.bottom"
        }
		],
      "default": "middle"
    },
    {
      "type": "select",
      "id": "btn_style",
      "label": "t:sections.all.buttons.button_style",
      "options": [
        {
          "value": "solid",
          "label": "t:sections.all.buttons.button_style_solid"
        },
        {
          "value": "outline",
          "label": "t:sections.all.buttons.button_style_outline"
        },
        {
          "value": "link",
          "label": "t:sections.all.buttons.button_style_link"
        }
		],
      "default": "solid"
    },
    {
      "type": "header",
      "content": "t:sections.collection-lookbook.settings.header_layout.content"
    },
    {
      "type": "select",
      "id": "content_width",
      "label": "t:sections.all.margin",
      "options": [
        {
          "value": "page-width",
          "label": "t:sections.all.normal"
        },
        {
          "value": "page-width-full-grid",
          "label": "t:sections.all.full_width"
        }
		],
      "default": "page-width-full-grid"
    },
    {
      "type": "range",
      "id": "card_spacing",
      "min": 0,
      "max": 60,
      "step": 10,
      "unit": "px",
      "default": 0,
      "label": "t:sections.all.layouts.horizontal_spacing"
    },
    {
      "type": "header",
      "content": "t:sections.all.colors.label"
    },
    {
      "type": "select",
      "id": "text_color",
      "options": [
        {
          "value": "fg-body",
          "label": "t:sections.all.colors.background_body.label"
        },
        {
          "value": "fg-01",
          "label": "t:sections.all.colors.accent_1.label"
        },
        {
          "value": "fg-02",
          "label": "t:sections.all.colors.accent_2.label"
        },
        {
          "value": "fg-03",
          "label": "t:sections.all.colors.accent_3.label"
        },
        {
          "value": "fg-04",
          "label": "t:sections.all.colors.accent_4.label"
        }
      ],
      "default": "fg-body",
      "label": "t:sections.all.colors.text_color.label"
    },
    {
      "type": "select",
      "id": "bg_color",
      "options": [
        {
          "value": "bg-body",
          "label": "t:sections.all.colors.background_body.label"
        },
        {
          "value": "bg-01",
          "label": "t:sections.all.colors.background_1.label"
        },
        {
          "value": "bg-02",
          "label": "t:sections.all.colors.background_2.label"
        },
        {
          "value": "bg-03",
          "label": "t:sections.all.colors.background_3.label"
        },
        {
          "value": "bg-04",
          "label": "t:sections.all.colors.background_4.label"
        }
      ],
      "default": "bg-body",
      "label": "t:sections.all.colors.background_color.label"
    },     
    {
      "type": "header",
      "content": "t:sections.all.padding.padding_mobile"
    },
    {
      "type": "range",
      "id": "padding_top_mobile",
      "min": 0,
      "max": 80,
      "step": 10,
      "unit": "px",
      "default": 40,
      "label": "t:sections.all.padding.padding_top"
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "min": 0,
      "max": 80,
      "step": 10,
      "unit": "px",
      "default": 40,
      "label": "t:sections.all.padding.padding_bottom"
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.padding_desktop"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 160,
      "step": 10,
      "unit": "px",
      "default": 60,
      "label": "t:sections.all.padding.padding_top"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 160,
      "step": 10,
      "unit": "px",
      "default": 60,
      "label": "t:sections.all.padding.padding_bottom"
    },
    {
      "type": "header",
      "content": "t:sections.all.border"
    },
    {
      "type": "checkbox",
      "id": "top_border",
      "default": false,
      "label": "t:sections.all.border_top"
    },
    {
      "type": "checkbox",
      "id": "bottom_border",
      "default": false,
      "label": "t:sections.all.border_bottom"
    },
    {
      "type": "select",
      "id": "border_width",
      "label": "t:sections.all.width",
      "options": [
        {
          "value": "normal",
          "label": "t:sections.all.normal"
        },
        {
          "value": "full",
          "label": "t:sections.all.full_width"
        }
        ],
      "default": "normal"
    },
    {
      "type": "select",
      "id": "border_color",
      "label": "t:sections.all.border_color",
      "options": [
        {
          "value": "dark",
          "label": "t:sections.all.colors.dark.label"
        },
        {
          "value": "light",
          "label": "t:sections.all.colors.light.label"
        }
        ],
      "default": "dark"
    }
    ],
    "presets": [
    {
      "name": "t:sections.collection-lookbook.presets.name"
    }
  ]
}
{% endschema %}
